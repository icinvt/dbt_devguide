### 2. プロジェクトの構造

#### ディレクトリ構成

dbtプロジェクトのディレクトリ構成は、プロジェクトの効率的な管理とメンテナンスにおいて重要な役割を果たします。このガイドラインでは、標準的なディレクトリ構造に従うことを推奨します。適切な構造を維持することで、チーム全体での作業が統一され、スケーラブルなデータモデリングが可能になります。以下は、一般的なdbtプロジェクトにおける推奨されるディレクトリ構造です。

1. **`models/` ディレクトリ**  
   このディレクトリには、すべてのdbtモデルが格納されます。各モデルは、機能別またはデータソース別に整理され、サブディレクトリに分割されます。具体的には、以下のようなディレクトリ構造を推奨します。

   - **`models/marts/`**  
     ビジネスマートレイヤーのモデルを格納します。ビジネスニーズに基づいて集計されたデータがここに配置され、事実テーブル（`fct_`）やディメンションテーブル（`dim_`）がこのフォルダーに格納されます。

   - **`models/staging/`**  
     ソースデータをクリーニングし、dbtの処理用に準備するためのステージングモデルを格納します。各データソースごとに1つのサブディレクトリを作成し、各ソースのテーブルに対応するステージングモデルを配置します（例: `stg_braintree.sql`、`stg_stripe.sql`）。

   - **`models/intermediate/`**  
     中間レイヤーのモデルを格納します。これらのモデルは、ステージングデータとビジネスマートデータの間で追加の変換やロジックを提供する役割を果たします。ファイル名には`int_`をプレフィックスとして使用します。

2. **`macros/` ディレクトリ**  
   再利用可能なJinjaテンプレートとカスタムマクロが含まれます。これにより、複雑なSQLロジックを簡略化し、コードの重複を防ぎます。すべてのマクロはこのディレクトリに格納され、プロジェクト全体で参照されます。

3. **`tests/` ディレクトリ**  
   カスタムテストが格納されます。各モデルのテストは、そのモデルが含まれているディレクトリ内に存在する必要があります。これにより、関連するテストとドキュメントを迅速に参照できるようになります。

4. **`snapshots/` ディレクトリ**  
   スナップショット機能を使用する場合、このディレクトリに時系列データの保存設定が格納されます。スナップショットは、データの履歴を追跡し、変更が行われた際のデータの状態を保存します。

5. **`seeds/` ディレクトリ**  
   静的データを保持するCSVファイルを格納します。これらのファイルは、dbtによってデータベースにロードされ、他のモデルから参照されるテーブルとして使用されます。

このディレクトリ構造を遵守することで、プロジェクト内のファイルが一貫性を持って整理され、チーム全体の効率が向上します。適切なディレクトリへのモデルの配置により、メンテナンスが容易になり、長期的なスケーラビリティが確保されます。

【参考: dbt Project Evaluatorのディレクトリ構造に関するルール】